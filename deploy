#!/bin/bash

if [ -z "$ENV" ]; then
  echo "ðŸ’â€â™€ï¸ Usage: ENV=staging npm run deploy"
  echo "(or production, note: not prod)"
  echo
  rm -rf ./dist
  exit 1
fi

if [ $ENV == "staging" ]
then
  FOLDER=docs-staging
  BRANCH=develop
elif [ $ENV == "production" ]
then
  FOLDER=docs
  BRANCH=main
else
  echo "ðŸ¤·â€â™€ï¸ Target unknown"
  exit 1
fi

npm run build &&

(tar -zcf - ./docs/.vitepress/dist | ssh static@static.apostrophecms.com "cat > /opt/static/static/$ENV-docs.tar.gz") &&

echo "Now run: CLOUD=website-$ENV act redeploy"
